import { PrismaClient, Role } from '@prisma/client';
import * as bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

// Sample content data ph√π h·ª£p v·ªõi Lexical Editor
const samplePostContent = {
  root: {
    children: [
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "Ch√†o m·ª´ng ƒë·∫øn v·ªõi Content Editor! üöÄ",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "heading",
        tag: "h1",
        version: 1,
      },
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "ƒê√¢y l√† m·ªôt b√†i vi·∫øt m·∫´u ƒë∆∞·ª£c t·∫°o b·ªüi seed script. N·ªôi dung n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ t∆∞∆°ng th√≠ch v·ªõi Lexical Editor ƒë∆∞·ª£c s·ª≠ d·ª•ng trong core-cms.",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "paragraph",
        version: 1,
      },
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "T√≠nh nƒÉng ch√≠nh c·ªßa Content Editor:",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "heading",
        tag: "h2",
        version: 1,
      },
      {
        children: [
          {
            children: [
              {
                children: [
                  {
                    detail: 0,
                    format: 0,
                    mode: "normal",
                    style: "",
                    text: "WYSIWYG Editor v·ªõi Lexical",
                    type: "text",
                    version: 1,
                  },
                ],
                direction: "ltr",
                format: "",
                indent: 0,
                type: "listitem",
                version: 1,
              },
              {
                children: [
                  {
                    detail: 0,
                    format: 0,
                    mode: "normal",
                    style: "",
                    text: "H·ªó tr·ª£ nhi·ªÅu ƒë·ªãnh d·∫°ng vƒÉn b·∫£n",
                    type: "text",
                    version: 1,
                  },
                ],
                direction: "ltr",
                format: "",
                indent: 0,
                type: "listitem",
                version: 1,
              },
              {
                children: [
                  {
                    detail: 0,
                    format: 0,
                    mode: "normal",
                    style: "",
                    text: "T√≠ch h·ª£p h√¨nh ·∫£nh v√† media",
                    type: "text",
                    version: 1,
                  },
                ],
                direction: "ltr",
                format: "",
                indent: 0,
                type: "listitem",
                version: 1,
              },
              {
                children: [
                  {
                    detail: 0,
                    format: 0,
                    mode: "normal",
                    style: "",
                    text: "Qu·∫£n l√Ω categories v√† tags",
                    type: "text",
                    version: 1,
                  },
                ],
                direction: "ltr",
                format: "",
                indent: 0,
                type: "listitem",
                version: 1,
              },
            ],
            direction: "ltr",
            format: "",
            indent: 0,
            type: "list",
            listType: "bullet",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "paragraph",
        version: 1,
      },
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "H·ªá th·ªëng ƒë∆∞·ª£c x√¢y d·ª±ng v·ªõi NestJS v√† Prisma, ƒë·∫£m b·∫£o hi·ªáu su·∫•t cao v√† d·ªÖ b·∫£o tr√¨.",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "paragraph",
        version: 1,
      },
    ],
    direction: "ltr",
    format: "",
    indent: 0,
    type: "root",
    version: 1,
  },
};

const samplePostContent2 = {
  root: {
    children: [
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng Content Editor",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "heading",
        tag: "h1",
        version: 1,
      },
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "Trong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu c√°ch s·ª≠ d·ª•ng Content Editor m·ªôt c√°ch hi·ªáu qu·∫£ nh·∫•t.",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "paragraph",
        version: 1,
      },
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "B∆∞·ªõc 1: T·∫°o n·ªôi dung m·ªõi",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "heading",
        tag: "h2",
        version: 1,
      },
      {
        children: [
          {
            detail: 0,
            format: 0,
            mode: "normal",
            style: "",
            text: "ƒê·ªÉ t·∫°o n·ªôi dung m·ªõi, b·∫°n c·∫ßn truy c·∫≠p v√†o trang editor v√† b·∫Øt ƒë·∫ßu nh·∫≠p n·ªôi dung. S·ª≠ d·ª•ng thanh c√¥ng c·ª• ƒë·ªÉ ƒë·ªãnh d·∫°ng vƒÉn b·∫£n theo √Ω mu·ªën.",
            type: "text",
            version: 1,
          },
        ],
        direction: "ltr",
        format: "",
        indent: 0,
        type: "paragraph",
        version: 1,
      },
    ],
    direction: "ltr",
    format: "",
    indent: 0,
    type: "root",
    version: 1,
  },
};

async function main() {
  console.log('üå± B·∫Øt ƒë·∫ßu seed database...');

  // T·∫°o roles
  const roles = await Promise.all([
    prisma.roleModel.upsert({
      where: { name: 'SUPER_ADMIN' },
      update: {},
      create: {
        name: 'SUPER_ADMIN',
        displayName: 'Super Administrator',
        description: 'To√†n quy·ªÅn h·ªá th·ªëng, c√≥ th·ªÉ th·ª±c hi·ªán m·ªçi thao t√°c',
      },
    }),
    prisma.roleModel.upsert({
      where: { name: 'ADMIN' },
      update: {},
      create: {
        name: 'ADMIN',
        displayName: 'Administrator',
        description: 'Qu·∫£n tr·ªã vi√™n, c√≥ quy·ªÅn qu·∫£n l√Ω n·ªôi dung v√† ng∆∞·ªùi d√πng',
      },
    }),
    prisma.roleModel.upsert({
      where: { name: 'EDITOR' },
      update: {},
      create: {
        name: 'EDITOR',
        displayName: 'Editor',
        description: 'Bi√™n t·∫≠p vi√™n, c√≥ quy·ªÅn t·∫°o v√† ch·ªânh s·ª≠a n·ªôi dung',
      },
    }),
    prisma.roleModel.upsert({
      where: { name: 'USER' },
      update: {},
      create: {
        name: 'USER',
        displayName: 'User',
        description: 'Ng∆∞·ªùi d√πng th√¥ng th∆∞·ªùng, quy·ªÅn h·∫°n h·∫°n ch·∫ø',
      },
    }),
  ]);

  console.log('‚úÖ ƒê√£ t·∫°o roles');

  // T·∫°o permissions d·ª±a tr√™n permission matrix
  const permissions = await Promise.all([
    // Admin permissions
    prisma.permission.upsert({
      where: { name: 'admin:view' },
      update: {},
      create: {
        name: 'admin:view',
        displayName: 'Xem Admin Dashboard',
        description: 'Quy·ªÅn truy c·∫≠p v√†o khu v·ª±c qu·∫£n tr·ªã',
        resource: 'admin',
        action: 'view',
        pathPattern: '/admin',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'settings:update' },
      update: {},
      create: {
        name: 'settings:update',
        displayName: 'C·∫≠p nh·∫≠t c√†i ƒë·∫∑t',
        description: 'Quy·ªÅn c·∫≠p nh·∫≠t c√†i ƒë·∫∑t h·ªá th·ªëng',
        resource: 'settings',
        action: 'update',
        pathPattern: '/admin/settings',
      },
    }),

    // Posts permissions
    prisma.permission.upsert({
      where: { name: 'posts:create' },
      update: {},
      create: {
        name: 'posts:create',
        displayName: 'T·∫°o b√†i vi·∫øt',
        description: 'Quy·ªÅn t·∫°o b√†i vi·∫øt m·ªõi',
        resource: 'posts',
        action: 'create',
        pathPattern: '/admin/posts',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:update' },
      update: {},
      create: {
        name: 'posts:update',
        displayName: 'Ch·ªânh s·ª≠a b√†i vi·∫øt',
        description: 'Quy·ªÅn ch·ªânh s·ª≠a b√†i vi·∫øt',
        resource: 'posts',
        action: 'update',
        pathPattern: '/admin/posts/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:publish' },
      update: {},
      create: {
        name: 'posts:publish',
        displayName: 'Xu·∫•t b·∫£n b√†i vi·∫øt',
        description: 'Quy·ªÅn xu·∫•t b·∫£n v√† ·∫©n b√†i vi·∫øt',
        resource: 'posts',
        action: 'publish',
        pathPattern: '/admin/posts/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:delete' },
      update: {},
      create: {
        name: 'posts:delete',
        displayName: 'X√≥a b√†i vi·∫øt',
        description: 'Quy·ªÅn x√≥a b√†i vi·∫øt (soft delete)',
        resource: 'posts',
        action: 'delete',
        pathPattern: '/admin/posts/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:hard-delete' },
      update: {},
      create: {
        name: 'posts:hard-delete',
        displayName: 'X√≥a vƒ©nh vi·ªÖn b√†i vi·∫øt',
        description: 'Quy·ªÅn x√≥a vƒ©nh vi·ªÖn b√†i vi·∫øt',
        resource: 'posts',
        action: 'hard-delete',
        pathPattern: '/admin/posts/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:restore' },
      update: {},
      create: {
        name: 'posts:restore',
        displayName: 'Kh√¥i ph·ª•c b√†i vi·∫øt',
        description: 'Quy·ªÅn kh√¥i ph·ª•c b√†i vi·∫øt ƒë√£ x√≥a',
        resource: 'posts',
        action: 'restore',
        pathPattern: '/admin/posts/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:bulk-delete' },
      update: {},
      create: {
        name: 'posts:bulk-delete',
        displayName: 'X√≥a h√†ng lo·∫°t b√†i vi·∫øt',
        description: 'Quy·ªÅn x√≥a nhi·ªÅu b√†i vi·∫øt c√πng l√∫c',
        resource: 'posts',
        action: 'bulk-delete',
        pathPattern: '/admin/posts',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:bulk-restore' },
      update: {},
      create: {
        name: 'posts:bulk-restore',
        displayName: 'Kh√¥i ph·ª•c h√†ng lo·∫°t b√†i vi·∫øt',
        description: 'Quy·ªÅn kh√¥i ph·ª•c nhi·ªÅu b√†i vi·∫øt c√πng l√∫c',
        resource: 'posts',
        action: 'bulk-restore',
        pathPattern: '/admin/posts',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'posts:bulk-hard-delete' },
      update: {},
      create: {
        name: 'posts:bulk-hard-delete',
        displayName: 'X√≥a vƒ©nh vi·ªÖn h√†ng lo·∫°t b√†i vi·∫øt',
        description: 'Quy·ªÅn x√≥a vƒ©nh vi·ªÖn nhi·ªÅu b√†i vi·∫øt c√πng l√∫c',
        resource: 'posts',
        action: 'bulk-hard-delete',
        pathPattern: '/admin/posts',
      },
    }),

    // Users permissions
    prisma.permission.upsert({
      where: { name: 'users:create' },
      update: {},
      create: {
        name: 'users:create',
        displayName: 'T·∫°o ng∆∞·ªùi d√πng',
        description: 'Quy·ªÅn t·∫°o ng∆∞·ªùi d√πng m·ªõi',
        resource: 'users',
        action: 'create',
        pathPattern: '/admin/users',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'users:update' },
      update: {},
      create: {
        name: 'users:update',
        displayName: 'Ch·ªânh s·ª≠a ng∆∞·ªùi d√πng',
        description: 'Quy·ªÅn ch·ªânh s·ª≠a th√¥ng tin ng∆∞·ªùi d√πng',
        resource: 'users',
        action: 'update',
        pathPattern: '/admin/users/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'users:delete' },
      update: {},
      create: {
        name: 'users:delete',
        displayName: 'X√≥a ng∆∞·ªùi d√πng',
        description: 'Quy·ªÅn x√≥a ng∆∞·ªùi d√πng',
        resource: 'users',
        action: 'delete',
        pathPattern: '/admin/users/[id]',
      },
    }),

    // Categories permissions
    prisma.permission.upsert({
      where: { name: 'categories:create' },
      update: {},
      create: {
        name: 'categories:create',
        displayName: 'T·∫°o danh m·ª•c',
        description: 'Quy·ªÅn t·∫°o danh m·ª•c m·ªõi',
        resource: 'categories',
        action: 'create',
        pathPattern: '/admin/categories',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'categories:update' },
      update: {},
      create: {
        name: 'categories:update',
        displayName: 'Ch·ªânh s·ª≠a danh m·ª•c',
        description: 'Quy·ªÅn ch·ªânh s·ª≠a danh m·ª•c',
        resource: 'categories',
        action: 'update',
        pathPattern: '/admin/categories/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'categories:delete' },
      update: {},
      create: {
        name: 'categories:delete',
        displayName: 'X√≥a danh m·ª•c',
        description: 'Quy·ªÅn x√≥a danh m·ª•c',
        resource: 'categories',
        action: 'delete',
        pathPattern: '/admin/categories/[id]',
      },
    }),

    // Tags permissions
    prisma.permission.upsert({
      where: { name: 'tags:create' },
      update: {},
      create: {
        name: 'tags:create',
        displayName: 'T·∫°o tag',
        description: 'Quy·ªÅn t·∫°o tag m·ªõi',
        resource: 'tags',
        action: 'create',
        pathPattern: '/admin/tags',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'tags:update' },
      update: {},
      create: {
        name: 'tags:update',
        displayName: 'Ch·ªânh s·ª≠a tag',
        description: 'Quy·ªÅn ch·ªânh s·ª≠a tag',
        resource: 'tags',
        action: 'update',
        pathPattern: '/admin/tags/[id]',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'tags:delete' },
      update: {},
      create: {
        name: 'tags:delete',
        displayName: 'X√≥a tag',
        description: 'Quy·ªÅn x√≥a tag',
        resource: 'tags',
        action: 'delete',
        pathPattern: '/admin/tags/[id]',
      },
    }),

    // Comments permissions
    prisma.permission.upsert({
      where: { name: 'comments:moderate' },
      update: {},
      create: {
        name: 'comments:moderate',
        displayName: 'Ki·ªÉm duy·ªát b√¨nh lu·∫≠n',
        description: 'Quy·ªÅn ph√™ duy·ªát v√† t·ª´ ch·ªëi b√¨nh lu·∫≠n',
        resource: 'comments',
        action: 'moderate',
        pathPattern: '/admin/comments',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'comments:delete' },
      update: {},
      create: {
        name: 'comments:delete',
        displayName: 'X√≥a b√¨nh lu·∫≠n',
        description: 'Quy·ªÅn x√≥a b√¨nh lu·∫≠n',
        resource: 'comments',
        action: 'delete',
        pathPattern: '/admin/comments/[id]',
      },
    }),

    // Trash permissions
    prisma.permission.upsert({
      where: { name: 'trash:restore' },
      update: {},
      create: {
        name: 'trash:restore',
        displayName: 'Kh√¥i ph·ª•c t·ª´ th√πng r√°c',
        description: 'Quy·ªÅn kh√¥i ph·ª•c c√°c item t·ª´ th√πng r√°c',
        resource: 'trash',
        action: 'restore',
        pathPattern: '/admin/trash',
      },
    }),
    prisma.permission.upsert({
      where: { name: 'trash:delete' },
      update: {},
      create: {
        name: 'trash:delete',
        displayName: 'X√≥a vƒ©nh vi·ªÖn t·ª´ th√πng r√°c',
        description: 'Quy·ªÅn x√≥a vƒ©nh vi·ªÖn c√°c item t·ª´ th√πng r√°c',
        resource: 'trash',
        action: 'delete',
        pathPattern: '/admin/trash',
      },
    }),
  ]);

  console.log('‚úÖ ƒê√£ t·∫°o permissions');

  // G√°n permissions cho roles theo permission matrix
  const rolePermissions = [
    // SUPER_ADMIN - c√≥ t·∫•t c·∫£ quy·ªÅn
    ...permissions.map(permission => ({
      roleId: roles.find(r => r.name === 'SUPER_ADMIN')!.id,
      permissionId: permission.id,
    })),

    // ADMIN - quy·ªÅn qu·∫£n l√Ω n·ªôi dung v√† ng∆∞·ªùi d√πng
    ...permissions.filter(p => 
      p.name.startsWith('admin:') ||
      p.name.startsWith('posts:') ||
      p.name.startsWith('categories:') ||
      p.name.startsWith('tags:') ||
      p.name.startsWith('comments:') ||
      p.name.startsWith('trash:')
    ).map(permission => ({
      roleId: roles.find(r => r.name === 'ADMIN')!.id,
      permissionId: permission.id,
    })),

    // EDITOR - quy·ªÅn t·∫°o v√† ch·ªânh s·ª≠a n·ªôi dung
    ...permissions.filter(p => 
      p.name === 'admin:view' ||
      p.name === 'posts:create' ||
      p.name === 'posts:update' ||
      p.name === 'categories:create' ||
      p.name === 'categories:update' ||
      p.name === 'tags:create' ||
      p.name === 'tags:update' ||
      p.name === 'comments:moderate'
    ).map(permission => ({
      roleId: roles.find(r => r.name === 'EDITOR')!.id,
      permissionId: permission.id,
    })),

    // USER - quy·ªÅn h·∫°n h·∫°n ch·∫ø
    ...permissions.filter(p => 
      p.name === 'admin:view'
    ).map(permission => ({
      roleId: roles.find(r => r.name === 'USER')!.id,
      permissionId: permission.id,
    })),
  ];

  await prisma.rolePermission.createMany({
    data: rolePermissions,
    skipDuplicates: true,
  });

  console.log('‚úÖ ƒê√£ g√°n permissions cho roles');

  // T·∫°o users
  const hashedPassword = await bcrypt.hash('password123', 10);
  
  const adminUser = await prisma.user.upsert({
    where: { email: 'admin@phgroup.com' },
    update: {},
    create: {
      email: 'admin@phgroup.com',
      name: 'PHGroup Admin',
      password: hashedPassword,
      role: Role.SUPER_ADMIN,
    },
  });

  const editorUser = await prisma.user.upsert({
    where: { email: 'editor@phgroup.com' },
    update: {},
    create: {
      email: 'editor@phgroup.com',
      name: 'PHGroup Editor',
      password: hashedPassword,
      role: Role.EDITOR,
    },
  });

  const authorUser = await prisma.user.upsert({
    where: { email: 'author@phgroup.com' },
    update: {},
    create: {
      email: 'author@phgroup.com',
      name: 'PHGroup Author',
      password: hashedPassword,
      role: Role.USER,
    },
  });

  // G√°n roles m·ªõi cho users
  await prisma.userRole.createMany({
    data: [
      {
        userId: adminUser.id,
        roleId: roles.find(r => r.name === 'SUPER_ADMIN')!.id,
      },
      {
        userId: editorUser.id,
        roleId: roles.find(r => r.name === 'EDITOR')!.id,
      },
      {
        userId: authorUser.id,
        roleId: roles.find(r => r.name === 'USER')!.id,
      },
    ],
    skipDuplicates: true,
  });

  console.log('‚úÖ ƒê√£ t·∫°o users');

  // T·∫°o categories
  const categories = await Promise.all([
    prisma.category.upsert({
      where: { slug: 'huong-dan' },
      update: {},
      create: {
        name: 'H∆∞·ªõng d·∫´n',
        slug: 'huong-dan',
        description: 'C√°c b√†i vi·∫øt h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng h·ªá th·ªëng',
      },
    }),
    prisma.category.upsert({
      where: { slug: 'cong-nghe' },
      update: {},
      create: {
        name: 'C√¥ng ngh·ªá',
        slug: 'cong-nghe',
        description: 'Tin t·ª©c v√† xu h∆∞·ªõng c√¥ng ngh·ªá',
      },
    }),
    prisma.category.upsert({
      where: { slug: 'seo' },
      update: {},
      create: {
        name: 'SEO',
        slug: 'seo',
        description: 'T·ªëi ∆∞u h√≥a c√¥ng c·ª• t√¨m ki·∫øm',
      },
    }),
    prisma.category.upsert({
      where: { slug: 'ui-ux' },
      update: {},
      create: {
        name: 'UI/UX',
        slug: 'ui-ux',
        description: 'Thi·∫øt k·∫ø giao di·ªán v√† tr·∫£i nghi·ªám ng∆∞·ªùi d√πng',
      },
    }),
  ]);

  console.log('‚úÖ ƒê√£ t·∫°o categories');

  // T·∫°o tags
  const tags = await Promise.all([
    prisma.tag.upsert({
      where: { slug: 'content-editor' },
      update: {},
      create: {
        name: 'Content Editor',
        slug: 'content-editor',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'wysiwyg' },
      update: {},
      create: {
        name: 'WYSIWYG',
        slug: 'wysiwyg',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'lexical' },
      update: {},
      create: {
        name: 'Lexical',
        slug: 'lexical',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'react' },
      update: {},
      create: {
        name: 'React',
        slug: 'react',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'nextjs' },
      update: {},
      create: {
        name: 'Next.js',
        slug: 'nextjs',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'typescript' },
      update: {},
      create: {
        name: 'TypeScript',
        slug: 'typescript',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'nestjs' },
      update: {},
      create: {
        name: 'NestJS',
        slug: 'nestjs',
      },
    }),
    prisma.tag.upsert({
      where: { slug: 'prisma' },
      update: {},
      create: {
        name: 'Prisma',
        slug: 'prisma',
      },
    }),
  ]);

  console.log('‚úÖ ƒê√£ t·∫°o tags');

  // T·∫°o posts
  const post1 = await prisma.post.upsert({
    where: { slug: 'chao-mung-den-voi-content-editor' },
    update: {},
    create: {
      title: 'Ch√†o m·ª´ng ƒë·∫øn v·ªõi Content Editor! üöÄ',
      content: samplePostContent,
      excerpt: 'ƒê√¢y l√† m·ªôt b√†i vi·∫øt m·∫´u ƒë∆∞·ª£c t·∫°o b·ªüi seed script. N·ªôi dung n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ t∆∞∆°ng th√≠ch v·ªõi Lexical Editor ƒë∆∞·ª£c s·ª≠ d·ª•ng trong core-cms.',
      slug: 'chao-mung-den-voi-content-editor',
      image: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800&h=400&fit=crop',
      published: true,
      publishedAt: new Date(),
      authorId: adminUser.id,
    },
  });

  const post2 = await prisma.post.upsert({
    where: { slug: 'huong-dan-su-dung-content-editor' },
    update: {},
    create: {
      title: 'H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng Content Editor',
      content: samplePostContent2,
      excerpt: 'Trong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu c√°ch s·ª≠ d·ª•ng Content Editor m·ªôt c√°ch hi·ªáu qu·∫£ nh·∫•t.',
      slug: 'huong-dan-su-dung-content-editor',
      image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=400&fit=crop',
      published: true,
      publishedAt: new Date(),
      authorId: editorUser.id,
    },
  });

  const post3 = await prisma.post.upsert({
    where: { slug: 'tich-hop-lexical-voi-nestjs' },
    update: {},
    create: {
      title: 'T√≠ch h·ª£p Lexical v·ªõi NestJS v√† Prisma',
      content: samplePostContent,
      excerpt: 'H∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ c√°ch t√≠ch h·ª£p Lexical Editor v·ªõi NestJS backend v√† Prisma ORM.',
      slug: 'tich-hop-lexical-voi-nestjs',
      image: 'https://images.unsplash.com/photo-1551650975-87deedd944c3?w=800&h=400&fit=crop',
      published: true,
      authorId: authorUser.id,
    },
  });

  console.log('‚úÖ ƒê√£ t·∫°o posts');

  // Li√™n k·∫øt posts v·ªõi categories
  await prisma.postCategory.createMany({
    data: [
      { postId: post1.id, categoryId: categories[0].id }, // H∆∞·ªõng d·∫´n
      { postId: post1.id, categoryId: categories[1].id }, // C√¥ng ngh·ªá
      { postId: post2.id, categoryId: categories[0].id }, // H∆∞·ªõng d·∫´n
      { postId: post3.id, categoryId: categories[1].id }, // C√¥ng ngh·ªá
    ],
    skipDuplicates: true,
  });

  // Li√™n k·∫øt posts v·ªõi tags
  await prisma.postTag.createMany({
    data: [
      { postId: post1.id, tagId: tags[0].id }, // Content Editor
      { postId: post1.id, tagId: tags[1].id }, // WYSIWYG
      { postId: post1.id, tagId: tags[2].id }, // Lexical
      { postId: post1.id, tagId: tags[3].id }, // React
      { postId: post2.id, tagId: tags[0].id }, // Content Editor
      { postId: post2.id, tagId: tags[1].id }, // WYSIWYG
      { postId: post3.id, tagId: tags[2].id }, // Lexical
      { postId: post3.id, tagId: tags[6].id }, // NestJS
      { postId: post3.id, tagId: tags[7].id }, // Prisma
    ],
    skipDuplicates: true,
  });

  console.log('‚úÖ ƒê√£ li√™n k·∫øt posts v·ªõi categories v√† tags');

  // T·∫°o comments
  await prisma.comment.createMany({
    data: [
      {
        content: 'B√†i vi·∫øt r·∫•t hay v√† h·ªØu √≠ch! C·∫£m ∆°n t√°c gi·∫£ ƒë√£ chia s·∫ª.',
        approved: true,
        authorId: authorUser.id,
        postId: post1.id,
      },
      {
        content: 'T√¥i ƒë√£ th·ª≠ v√† th·∫•y r·∫•t d·ªÖ s·ª≠ d·ª•ng. Recommend cho m·ªçi ng∆∞·ªùi!',
        approved: true,
        authorId: editorUser.id,
        postId: post1.id,
      },
      {
        content: 'C√≥ th·ªÉ chia s·∫ª th√™m v·ªÅ c√°ch customize editor kh√¥ng?',
        approved: false,
        authorId: authorUser.id,
        postId: post2.id,
      },
    ],
  });

  console.log('‚úÖ ƒê√£ t·∫°o comments');

  console.log('üéâ Seed database ho√†n th√†nh!');
  console.log('\nüìä Th·ªëng k√™:');
  console.log(`- Roles: ${roles.length} (SUPER_ADMIN, ADMIN, EDITOR, USER)`);
  console.log(`- Permissions: ${permissions.length} (t·∫•t c·∫£ permissions t·ª´ permission matrix)`);
  console.log(`- Users: 3 (1 Super Admin, 1 Editor, 1 User)`);
  console.log(`- Categories: ${categories.length}`);
  console.log(`- Tags: ${tags.length}`);
  console.log(`- Posts: 3 (2 published, 1 draft)`);
  console.log(`- Comments: 3 (2 approved, 1 pending)`);
  console.log('\nüîê Permission System:');
  console.log('‚úÖ SUPER_ADMIN: To√†n quy·ªÅn h·ªá th·ªëng');
  console.log('‚úÖ ADMIN: Qu·∫£n l√Ω n·ªôi dung v√† ng∆∞·ªùi d√πng');
  console.log('‚úÖ EDITOR: T·∫°o v√† ch·ªânh s·ª≠a n·ªôi dung');
  console.log('‚úÖ USER: Quy·ªÅn h·∫°n h·∫°n ch·∫ø');
  console.log('\nüîë Th√¥ng tin ƒëƒÉng nh·∫≠p:');
  console.log('Email: admin@phgroup.com | Password: password123 (SUPER_ADMIN)');
  console.log('Email: editor@phgroup.com | Password: password123 (EDITOR)');
  console.log('Email: author@phgroup.com | Password: password123 (USER)');
}

main()
  .catch((e) => {
    console.error('‚ùå L·ªói khi seed database:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
